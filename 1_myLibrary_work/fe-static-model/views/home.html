{% extends 'layout.html' %}

{% block jsPages %}
    <script src="/static/js/app.js" type="text/javascript"></script>
{% endblock %}

{% block bodyClass %}home-wrap{% endblock %}

{% block content %}
    <div class="container">
        <div id="tab_bar" class="row mb-20">
            <ul class="nav nav-pills">
                <li data-type="logview" data-table="table_logview" data-url="" data-template="" role="presentation"
                    class="active"><a href="#">日志</a></li>
                <li data-type="resource" data-table="table_monitor_resource" data-url="/monitor/resource.json" data-template="t_resource"
                    role="presentation"><a href="#">资源</a></li>
                <li data-type="process" data-table="table_monitor_ps" data-url="/monitor/ps.json"
                    data-template="t_process" role="presentation"><a href="#">进程</a></li>
                <li data-type="monitor" data-table="table_moniready" data-url="/monitor/checkall.json"
                    data-template="t_monitor" role="presentation"><a href="#">监控</a></li>
            </ul>
        </div>
        <div id="search_box" class="row">
            <form class="form-horizontal" method="post" action="">
                <div class="form-group">
                    <label for="time_from" class="col-sm-2 control-label">开始时间 : </label>

                    <div class="col-sm-7 has-feedback">
                        <input readonly="readonly" id="time_from" class="form-control" name="time_from" type="text"
                               placeholder="开始时间" value="2015/11/11">
                        {#<span class="glyphicon glyphicon-calendar form-control-feedback" aria-hidden="true"></span>#}
                        {#<span id="inputSuccess5Status" class="sr-only">(success)</span>#}
                    </div>
                </div>
                <div class="form-group">
                    <label for="time_to" class="col-sm-2 control-label">结束时间 : </label>

                    <div class="col-sm-7 has-feedback">
                        <input readonly="readonly" id="time_to" class="form-control" name="time_to" type="text"
                               placeholder="结束时间" value="2015/11/11">
                        {#<span class="glyphicon glyphicon-calendar form-control-feedback" aria-hidden="true"></span>#}
                        {#<span id="inputSuccess5Status" class="sr-only">(success)</span>#}
                    </div>
                </div>
                <div class="form-group">
                    <label for="file" class="col-sm-2 control-label">文件路径、名称 : </label>

                    <div class="col-sm-7">
                        <input id="file" class="form-control" name="file" type="text"
                               placeholder="例如 : /home/a/share/htdocs/goodbenchtaskcenter/log/online.log" value="/home">
                    </div>
                </div>
                <div class="form-group">
                    <label for="ip" class="col-sm-2 control-label">IP : </label>

                    <div class="col-sm-7">
                        <input id="ip" class="form-control" name="ip" type="text" placeholder="例如 : 192.168.1.1"
                               value="192.168.1.1">
                    </div>
                </div>
                <div class="btn-bar-line"></div>
                <div class="form-group ">
                    <div class="col-sm-offset-2 col-sm-7">
                        <button type="submit" class="btn btn-primary mr-20" id="check_logview">查 询</button>
                        <button type="reset" class="btn btn-default mr-20">重 置</button>
                    </div>
                </div>
            </form>
        </div>

        <div id="table_logview" class="row table-container"></div>
        <div id="table_monitor_resource" class="row table-container"></div>
        <div id="table_monitor_ps" class="row table-container"></div>
        <div id="table_moniready" class="row table-container"></div>

    </div>

    <script id="t_logview" type="text/template">
        <h2>日志数据</h2>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>Time/IP</th>
                <th>Content</th>
            </tr>
            </thead>
            <tbody>
            <% _.each(data, function(item){ %>
            <tr>
                <td scope="row">
                    <span><%= item.time%></span>
                    </br>
                    <span><%= item.source_ip%></span>
                </td>
                <td>
                    <span><%= item.action%></span>
                    </br>
                    <span><%= item.client_id%></span>
                    </br>
                    <span><%= item.client_ip%></span>
                    </br>
                    <span><%= item.task_id%></span>
                    </br>
                    <span><%= item.task_type%></span>
                </td>
            </tr>
            <% }) %>
            </tbody>
        </table>
    </script>
    <script id="t_resource" type="text/template">
        <h2>资源数据</h2>
        <% _.each(data, function(value, key){ %>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th width="45%"><%= key %></th>
                <th width="55%">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            <% _.each(value, function(val, k){ %>
                <% if (k !== 'status') { %>
                <tr>
                    <td scope="row">
                        <span><%= k %></span>
                    </td>
                    <td>
                        <% _.each(val, function (_val, _k){ %>
                        <span><%= _k %> : <%= _val %></span>
                        </br>
                        <% })%>
                    </td>
                </tr>
                <% } %>
            <% }) %>
            </tbody>
        </table>
        <% }) %>
    </script>
    <script id="t_process" type="text/template">
        <h2>日志数据</h2>
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>类型</th>
                <th>从机资源信息</th>
            </tr>
            </thead>
            <tbody>
            <% _.each(data, function(item, key){ %>
            <tr>
                <td scope="row">
                    <span><%= key%></span>
                </td>
                <td>
                    <table class="table table-bordered">
                        <tbody>
                        <% _.each(item, function(val, idx){ %>
                        <tr>
                            <td><%= idx %></td>
                            <td>
                                <span><%= val.user%></span>
                                <br/>
                                <span><%= val.pid%></span>
                                <br/>
                                <span><%= val.cpu%></span>
                                <br/>
                                <span><%= val.mem%></span>
                                <br/>
                                <span><%= val.vsz%></span>
                                <br/>
                                <span><%= val.rss%></span>
                            </td>
                        </tr>
                        <% }) %>
                        </tbody>
                    </table>
                </td>
            </tr>
            <% }) %>
            </tbody>
        </table>
    </script>
    <script id="t_monitor" type="text/template">
        <h2>监控状态</h2>
        <% if(status === 'ok'){ %>
        <div class="alert alert-success" role="alert">
            <a href="#" class="alert-link">Well done! </a>
        </div>
        <% } else { %>
        <div class="alert alert-danger" role="alert">
            <a href="#" class="alert-link">Oh snap! </a>
        </div>
        <% } %>
    </script>
{% endblock %}
